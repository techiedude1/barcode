<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-Tool Barcode Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Fonts for all tools -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <style>
    body { font-family: 'Inter', Arial, sans-serif; background: #f0f9ff; min-height: 100vh; margin: 0; padding: 0; }
    .main-title { font-size: 2.1rem; font-weight: 800; color: #374151; margin-top: 2.2rem; text-align: center; letter-spacing: .02em;}
    .tools-container { display: flex; flex-wrap: wrap; gap: 38px; justify-content: center; align-items: flex-start; margin: 2.3rem 0 2.7rem 0;}
    .barcode-tool { background: #fff; padding: 32px 22px 28px 22px; border-radius: 20px; box-shadow: 0 6px 28px rgba(0,0,0,0.07); width: 375px; max-width: 98vw; margin-bottom: 1.2rem; }
    .tool-title { font-size: 1.25rem; font-weight: 700; color: #2563eb; margin-bottom: 13px; text-align: center; }
    .input { font-size: 1rem; padding: 10px; border-radius: 10px; border: 1px solid #cbd5e1; width: 100%; margin-bottom: 12px; }
    .row { display: flex; gap: 12px; margin-bottom: 12px; }
    .row label { font-weight: 600; margin-right: 6px; }
    .row input { width: 100px; border-bottom: 2px solid #aaa; border-radius: 0; border-top: none; border-left: none; border-right: none; padding: 2px 4px; font-size: 1rem; margin-bottom: 0;}
    .barcode-preview { display: flex; flex-direction: column; align-items: center; margin: 16px 0 0 0;}
    .barcode-number { margin-top: 4px; font-size: 1.1rem; font-weight: 600; color: #f59e42; letter-spacing: 2px;}
    .display-text { margin-top: 6px; font-weight: 600; font-size: 1.05rem; color: #334155; }
    .exp-lot-row { margin-top: 8px; width: 100%; display: flex; justify-content: center; gap: 30px;}
    .btn { background: #2563eb; color: #fff; padding: 10px 20px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: background .2s; }
    .btn:disabled { background: #cbd5e1; cursor: not-allowed; }
    .notice { color: #64748b; font-size: 0.89rem; margin-top: 8px; text-align: center; }
    .divider { height: 2.2rem; }
    svg { display: block; }
    /* For fallback image in Tool 1 */
    .fallback-img-container { margin-top: 1.1rem; padding: 1rem; border: 1px dashed #cbd5e1; border-radius: 0.5rem; background-color: #f9fafb; text-align: center;}
    .fallback-img { display: block; margin: 0.5rem auto; border: 1px solid #e5e7eb; max-width: 100%; border-radius: 0.25rem; }
  </style>
</head>
<body>
  <div class="main-title">Multi-Tool Barcode Generator</div>
  <div class="tools-container">

    <!-- =========== TOOL 1: Original Full Barcode & Text Copier (with Fallback) ============ -->
    <div class="barcode-tool">
      <div class="tool-title">Barcode & Text Copier (with Fallback)</div>
      <input type="text" id="t1-barcode" class="input" placeholder="Barcode data (any value)">
      <textarea id="t1-addtext" class="input" rows="2" placeholder="Additional Text"></textarea>
      <div id="t1-preview" class="barcode-preview" style="min-height:120px;">
        <svg id="t1-barcode-svg" width="260" height="60"></svg>
        <div id="t1-displaytext" class="display-text"></div>
      </div>
      <button class="btn" id="t1-copybtn" disabled>Copy as Image</button>
      <div class="notice" id="t1-status"></div>
      <div id="t1-fallback" class="fallback-img-container" style="display:none;">
        <div style="font-size:0.93rem; color:#64748b;">Right-click below image to copy:</div>
        <img id="t1-fallback-img" class="fallback-img" alt="Barcode+Text"/>
      </div>
    </div>

    <!-- =========== TOOL 2: Simple Barcode + Text Generator (number, text below) ============ -->
    <div class="barcode-tool">
      <div class="tool-title">Barcode + Text Generator</div>
      <input id="t2-barcode" class="input" type="text" placeholder="Enter value for barcode..." autocomplete="off">
      <input id="t2-text" class="input" type="text" placeholder="Enter display text..." autocomplete="off">
      <div id="t2-preview" class="barcode-preview" style="display:none;">
        <svg id="t2-barcode-svg" width="260" height="60"></svg>
        <div id="t2-barnum" class="barcode-number"></div>
        <div id="t2-displaytext" class="display-text"></div>
      </div>
      <button class="btn" id="t2-copybtn" disabled>Copy Barcode & Text as Image</button>
      <div class="notice">Paste directly where image pasting is supported (Docs, email, chat, etc.)</div>
    </div>

    <!-- =========== TOOL 3: Barcode + Text + EXP/LOT ============ -->
    <div class="barcode-tool">
      <div class="tool-title">Barcode + Text + EXP/LOT</div>
      <input id="t3-barcode" class="input" type="text" placeholder="Enter value for barcode..." autocomplete="off">
      <input id="t3-text" class="input" type="text" placeholder="Enter display text..." autocomplete="off">
      <div class="row">
        <label for="t3-exp">EXP:</label>
        <input id="t3-exp" type="text" maxlength="15" placeholder="MM/YYYY">
        <label for="t3-lot">LOT#:</label>
        <input id="t3-lot" type="text" maxlength="20" placeholder="">
      </div>
      <div id="t3-preview" class="barcode-preview" style="display:none;">
        <svg id="t3-barcode-svg" width="320" height="60"></svg>
        <div id="t3-barnum" class="barcode-number"></div>
        <div id="t3-displaytext" class="display-text"></div>
        <div class="exp-lot-row">
          <span><b>EXP:</b> <span id="t3-expout" style="display:inline-block;min-width:80px;border-bottom:1.5px solid #aaa;">&nbsp;</span></span>
          <span><b>LOT#:</b> <span id="t3-lotout" style="display:inline-block;min-width:90px;border-bottom:1.5px solid #aaa;">&nbsp;</span></span>
        </div>
      </div>
      <button class="btn" id="t3-copybtn" disabled>Copy Barcode & Text as Image</button>
      <div class="notice">Paste directly where image pasting is supported (Docs, email, chat, etc.)</div>
    </div>
  </div>
  <script>
    // ========== TOOL 1 ==========
    const t1barcodeInput = document.getElementById('t1-barcode');
    const t1addTextInput = document.getElementById('t1-addtext');
    const t1barcodeSVG = document.getElementById('t1-barcode-svg');
    const t1displayText = document.getElementById('t1-displaytext');
    const t1copyBtn = document.getElementById('t1-copybtn');
    const t1status = document.getElementById('t1-status');
    const t1fallback = document.getElementById('t1-fallback');
    const t1fallbackImg = document.getElementById('t1-fallback-img');
    function t1update() {
      try {
        JsBarcode(t1barcodeSVG, t1barcodeInput.value, { format: "CODE128", displayValue: true, width: 2, height: 60, margin: 8, fontSize: 16 });
      } catch {}
      t1displayText.textContent = t1addTextInput.value;
      t1copyBtn.disabled = !t1barcodeInput.value && !t1addTextInput.value;
      t1fallback.style.display = 'none'; t1status.textContent = '';
    }
    t1barcodeInput.addEventListener('input', t1update);
    t1addTextInput.addEventListener('input', t1update);

    t1copyBtn.addEventListener('click', async () => {
      t1status.textContent = ''; t1fallback.style.display = 'none';
      // Canvas for barcode+text
      const hasBarcode = !!t1barcodeInput.value;
      const hasText = !!t1addTextInput.value;
      if (!hasBarcode && !hasText) return;
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      // Generate barcode image from SVG
      const svgXml = new XMLSerializer().serializeToString(t1barcodeSVG);
      const svgDataUrl = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svgXml)}`;
      const img = new Image();
      await new Promise((res, rej) => {
        img.onload = res;
        img.onerror = rej;
        img.src = svgDataUrl;
      });
      // Determine dimensions
      let textLines = [];
      let textFont = 'bold 16px Inter, Arial, sans-serif';
      ctx.font = textFont;
      if (hasText) {
        const words = t1addTextInput.value.split(/(\s+)/);
        let line = '';
        for (const w of words) {
          let test = line + w;
          if (ctx.measureText(test.trim()).width > 260 && line.trim() !== '') {
            textLines.push(line.trim()); line = w;
          } else line = test;
        }
        if (line.trim() !== '') textLines.push(line.trim());
      }
      const padding = 16, barcodeHeight = 60;
      const textHeight = textLines.length * 22;
      canvas.width = 300;
      canvas.height = barcodeHeight + textHeight + padding * 2;
      ctx.fillStyle = "#fff"; ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 20, padding, 260, 60);
      ctx.font = textFont; ctx.fillStyle = "#374151"; ctx.textAlign = 'center';
      textLines.forEach((line, i) => {
        ctx.fillText(line, canvas.width/2, barcodeHeight + padding + 18 + i * 22);
      });
      // Try copy to clipboard
      canvas.toBlob(async (blob) => {
        try {
          await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
          t1status.textContent = 'Copied as image!';
          t1status.style.color = "#16a34a";
        } catch {
          t1status.textContent = 'Copy failed. Right-click image below to copy.';
          t1status.style.color = "#b91c1c";
          t1fallbackImg.src = canvas.toDataURL();
          t1fallback.style.display = 'block';
        }
      });
    });
    t1update();

    // ========== TOOL 2 ==========
    const t2barcodeInput = document.getElementById('t2-barcode');
    const t2textInput = document.getElementById('t2-text');
    const t2barcodeSVG = document.getElementById('t2-barcode-svg');
    const t2barnum = document.getElementById('t2-barnum');
    const t2displayText = document.getElementById('t2-displaytext');
    const t2preview = document.getElementById('t2-preview');
    const t2copyBtn = document.getElementById('t2-copybtn');
    function t2formatNumber(val) { return val.replace(/\D/g, ''); }
    function t2update() {
      const val = t2barcodeInput.value;
      if (val) {
        try {
          JsBarcode(t2barcodeSVG, val, { format: "CODE128", displayValue: false, width: 2, height: 60, margin: 0 });
          t2barnum.textContent = t2formatNumber(val);
          t2displayText.textContent = t2textInput.value;
          t2preview.style.display = 'flex';
          t2copyBtn.disabled = false;
        } catch { t2preview.style.display = 'none'; t2copyBtn.disabled = true; }
      } else { t2preview.style.display = 'none'; t2copyBtn.disabled = true; }
    }
    t2barcodeInput.addEventListener('input', t2update);
    t2textInput.addEventListener('input', t2update);

    t2copyBtn.addEventListener('click', async () => {
      const svgString = new XMLSerializer().serializeToString(t2barcodeSVG);
      const img = new Image();
      const svgBlob = new Blob([svgString], {type:'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(svgBlob);
      img.src = url;
      img.onload = async function() {
        const w = 260, h = 60, numberLine = 22, textLine = 21;
        const canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = h + numberLine + textLine;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = "#fff"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, w, h);
        ctx.font = "bold 18px Inter, Arial, sans-serif";
        ctx.textAlign = "center"; ctx.fillStyle = "#f59e42";
        ctx.fillText(t2barnum.textContent, w/2, h + numberLine - 5);
        ctx.font = "bold 17px Inter, Arial, sans-serif"; ctx.fillStyle = "#334155";
        ctx.fillText(t2displayText.textContent, w/2, h + numberLine + textLine - 8);
        canvas.toBlob(async (blob) => {
          try {
            await navigator.clipboard.write([new window.ClipboardItem({ [blob.type]: blob })]);
            t2copyBtn.textContent = "Copied!";
            setTimeout(()=>{t2copyBtn.textContent = "Copy Barcode & Text as Image"}, 1200);
          } catch(e) { alert("Copy failed. Try right-clicking the image to copy."); }
          URL.revokeObjectURL(url);
        });
      };
    });

    // ========== TOOL 3 ==========
    const t3barcodeInput = document.getElementById('t3-barcode');
    const t3textInput = document.getElementById('t3-text');
    const t3expInput = document.getElementById('t3-exp');
    const t3lotInput = document.getElementById('t3-lot');
    const t3barcodeSVG = document.getElementById('t3-barcode-svg');
    const t3barnum = document.getElementById('t3-barnum');
    const t3displayText = document.getElementById('t3-displaytext');
    const t3expout = document.getElementById('t3-expout');
    const t3lotout = document.getElementById('t3-lotout');
    const t3preview = document.getElementById('t3-preview');
    const t3copyBtn = document.getElementById('t3-copybtn');
    function t3formatNumber(val) { return val.replace(/\D/g, ''); }
    function t3update() {
      const val = t3barcodeInput.value;
      if (val) {
        try {
          JsBarcode(t3barcodeSVG, val, { format: "CODE128", displayValue: false, width: 2, height: 60, margin: 0 });
          t3barnum.textContent = t3formatNumber(val);
          t3displayText.textContent = t3textInput.value;
          t3expout.textContent = t3expInput.value || '\u00A0';
          t3lotout.textContent = t3lotInput.value || '\u00A0';
          t3preview.style.display = 'flex';
          t3copyBtn.disabled = false;
        } catch { t3preview.style.display = 'none'; t3copyBtn.disabled = true; }
      } else { t3preview.style.display = 'none'; t3copyBtn.disabled = true; }
    }
    t3barcodeInput.addEventListener('input', t3update);
    t3textInput.addEventListener('input', t3update);
    t3expInput.addEventListener('input', t3update);
    t3lotInput.addEventListener('input', t3update);

    t3copyBtn.addEventListener('click', async () => {
      const svgString = new XMLSerializer().serializeToString(t3barcodeSVG);
      const img = new Image();
      const svgBlob = new Blob([svgString], {type:'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(svgBlob);
      img.src = url;
      img.onload = async function() {
        const w = 320, h = 60, numberLine = 22, textLine = 21, expLotLine = 26;
        const canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = h + numberLine + textLine + expLotLine;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = "#fff"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, w, h);
        ctx.font = "bold 18px Inter, Arial, sans-serif"; ctx.textAlign = "center"; ctx.fillStyle = "#f59e42";
        ctx.fillText(t3barnum.textContent, w/2, h + numberLine - 5);
        ctx.font = "bold 17px Inter, Arial, sans-serif"; ctx.fillStyle = "#334155";
        ctx.fillText(t3displayText.textContent, w/2, h + numberLine + textLine - 8);
        // EXP/LOT fields (left/right, underlined)
        ctx.font = "bold 16px Inter, Arial, sans-serif"; ctx.fillStyle = "#222"; ctx.textAlign = "left";
        const expLabel = "EXP:", lotLabel = "LOT#:";
        const expVal = t3expInput.value || '', lotVal = t3lotInput.value || '';
        const expX = 30, lotX = w/2 + 20, lineY = h + numberLine + textLine + expLotLine - 10;
        ctx.fillText(expLabel, expX, lineY);
        ctx.font = "16px Inter, Arial, sans-serif";
        ctx.fillText(expVal, expX + 45, lineY);
        const expWidth = Math.max(ctx.measureText(expVal||'MM/YYYY').width, 60);
        ctx.beginPath(); ctx.moveTo(expX + 43, lineY + 2); ctx.lineTo(expX + 43 + expWidth + 5, lineY + 2);
        ctx.strokeStyle = "#aaa"; ctx.lineWidth = 2; ctx.stroke();
        ctx.font = "bold 16px Inter, Arial, sans-serif";
        ctx.fillText(lotLabel, lotX, lineY);
        ctx.font = "16px Inter, Arial, sans-serif";
        ctx.fillText(lotVal, lotX + 60, lineY);
        const lotWidth = Math.max(ctx.measureText(lotVal||'').width, 65);
        ctx.beginPath(); ctx.moveTo(lotX + 57, lineY + 2); ctx.lineTo(lotX + 57 + lotWidth + 5, lineY + 2); ctx.strokeStyle = "#aaa"; ctx.lineWidth = 2; ctx.stroke();
        canvas.toBlob(async (blob) => {
          try {
            await navigator.clipboard.write([new window.ClipboardItem({ [blob.type]: blob })]);
            t3copyBtn.textContent = "Copied!";
            setTimeout(()=>{t3copyBtn.textContent = "Copy Barcode & Text as Image"}, 1200);
          } catch(e) { alert("Copy failed. Try right-clicking the image to copy."); }
          URL.revokeObjectURL(url);
        });
      };
    });

    // Initialize all previews for empty state
    t1update(); t2update(); t3update();
  </script>
</body>
</html>
