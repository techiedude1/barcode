<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Barcode & Label Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="barcode-favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <style>
    /* [Keep all your CSS here - unchanged from your paste] */
    body { font-family: 'Inter', Arial, sans-serif; background: #f0f9ff; min-height: 100vh; margin: 0; padding: 0; }
    /* ... rest of your CSS unchanged ... */
  </style>
</head>
<body>
  <!-- ... Your HTML exactly as before ... -->
  <!-- [Your existing HTML for all tools goes here, unchanged] -->

  <script>
    // ===== UTILS =====
    function svgToPngDataUrl(svgElem, width, height, scale=2, extraDrawCallback) {
      return new Promise((resolve) => {
        let svgData = new XMLSerializer().serializeToString(svgElem);
        let img = new Image();
        img.onload = function() {
          let canvas = document.createElement('canvas');
          canvas.width = width * scale;
          canvas.height = height * scale;
          let ctx = canvas.getContext('2d');
          ctx.fillStyle = "#fff";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          // Extra draw
          if (extraDrawCallback) extraDrawCallback(ctx, scale);
          resolve(canvas.toDataURL("image/png"));
        };
        img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
      });
    }

    function copyImageDataUrlToClipboard(dataUrl, fallbackImgElem, fallbackDiv) {
      if (navigator.clipboard && window.ClipboardItem) {
        fetch(dataUrl)
          .then(res => res.blob())
          .then(blob => {
            const item = new ClipboardItem({ [blob.type]: blob });
            navigator.clipboard.write([item]);
            if (fallbackDiv) fallbackDiv.style.display = 'none';
          });
      } else {
        // Fallback for older browsers: Show fallback image
        if (fallbackImgElem && fallbackDiv) {
          fallbackImgElem.src = dataUrl;
          fallbackDiv.style.display = '';
        }
      }
    }

    // ====== TOOL 1 ======
    const t1_barcode = document.getElementById('t1-barcode');
    const t1_addtext = document.getElementById('t1-addtext');
    const t1_preview = document.getElementById('t1-preview');
    const t1_svg = document.getElementById('t1-barcode-svg');
    const t1_displaytext = document.getElementById('t1-displaytext');
    const t1_copybtn = document.getElementById('t1-copybtn');
    const t1_status = document.getElementById('t1-status');
    const t1_fallbackDiv = document.getElementById('t1-fallback');
    const t1_fallbackImg = document.getElementById('t1-fallback-img');

    function updateT1() {
      let val = t1_barcode.value.trim();
      t1_svg.innerHTML = '';
      t1_displaytext.textContent = t1_addtext.value.trim();
      if (!val) {
        t1_copybtn.disabled = true;
        t1_status.textContent = '';
        return;
      }
      try {
        JsBarcode(t1_svg, val, {format: "CODE128", height: 54, width: 2, displayValue: false, margin: 2});
        t1_copybtn.disabled = false;
        t1_status.textContent = '';
      } catch {
        t1_copybtn.disabled = true;
        t1_status.textContent = 'Invalid barcode data.';
      }
    }
    t1_barcode.addEventListener('input', updateT1);
    t1_addtext.addEventListener('input', updateT1);

    t1_copybtn.onclick = async function() {
      t1_status.textContent = "Copying...";
      let dataUrl = await svgToPngDataUrl(t1_svg, 260, 60, 2, (ctx, scale) => {
        ctx.font = `bold ${19*scale}px Inter, Arial`;
        ctx.fillStyle = "#374151";
        ctx.textAlign = "center";
        let text = t1_addtext.value.trim();
        if (text) ctx.fillText(text, 130*scale, 58*scale+26);
      });
      copyImageDataUrlToClipboard(dataUrl, t1_fallbackImg, t1_fallbackDiv);
      t1_status.textContent = "Copied! Paste anywhere image is supported.";
    };

    // ====== TOOL 2 ======
    const t2_barcode = document.getElementById('t2-barcode');
    const t2_text = document.getElementById('t2-text');
    const t2_preview = document.getElementById('t2-preview');
    const t2_svg = document.getElementById('t2-barcode-svg');
    const t2_barnum = document.getElementById('t2-barnum');
    const t2_displaytext = document.getElementById('t2-displaytext');
    const t2_copybtn = document.getElementById('t2-copybtn');

    function updateT2() {
      let val = t2_barcode.value.trim();
      let text = t2_text.value.trim();
      if (!val) {
        t2_preview.style.display = "none";
        t2_copybtn.disabled = true;
        return;
      }
      t2_preview.style.display = "";
      JsBarcode(t2_svg, val, {format: "CODE128", height: 54, width: 2, displayValue: false, margin: 2});
      t2_barnum.textContent = val;
      t2_displaytext.textContent = text;
      t2_copybtn.disabled = false;
    }
    t2_barcode.addEventListener('input', updateT2);
    t2_text.addEventListener('input', updateT2);

    t2_copybtn.onclick = async function() {
      let dataUrl = await svgToPngDataUrl(t2_svg, 260, 60, 2, (ctx, scale) => {
        // Barcode number
        ctx.font = `bold ${19*scale}px Inter, Arial`;
        ctx.fillStyle = "#f59e42";
        ctx.textAlign = "center";
        ctx.fillText(t2_barcode.value.trim(), 130*scale, 58*scale+18);
        // Display text
        ctx.font = `bold ${16*scale}px Inter, Arial`;
        ctx.fillStyle = "#334155";
        ctx.fillText(t2_text.value.trim(), 130*scale, 58*scale+38);
      });
      copyImageDataUrlToClipboard(dataUrl);
    };

    // ====== TOOL 3 ======
    const t3_barcode = document.getElementById('t3-barcode');
    const t3_text = document.getElementById('t3-text');
    const t3_exp = document.getElementById('t3-exp');
    const t3_lot = document.getElementById('t3-lot');
    const t3_preview = document.getElementById('t3-preview');
    const t3_svg = document.getElementById('t3-barcode-svg');
    const t3_barnum = document.getElementById('t3-barnum');
    const t3_displaytext = document.getElementById('t3-displaytext');
    const t3_expout = document.getElementById('t3-expout');
    const t3_lotout = document.getElementById('t3-lotout');
    const t3_copybtn = document.getElementById('t3-copybtn');

    function updateT3() {
      let val = t3_barcode.value.trim();
      let text = t3_text.value.trim();
      let exp = t3_exp.value.trim();
      let lot = t3_lot.value.trim();
      if (!val) {
        t3_preview.style.display = "none";
        t3_copybtn.disabled = true;
        return;
      }
      t3_preview.style.display = "";
      JsBarcode(t3_svg, val, {format: "CODE128", height: 54, width: 2, displayValue: false, margin: 2});
      t3_barnum.textContent = val;
      t3_displaytext.textContent = text;
      t3_expout.textContent = exp || " ";
      t3_lotout.textContent = lot || " ";
      t3_copybtn.disabled = false;
    }
    [t3_barcode, t3_text, t3_exp, t3_lot].forEach(el => el.addEventListener('input', updateT3));

    t3_copybtn.onclick = async function() {
      let dataUrl = await svgToPngDataUrl(t3_svg, 320, 60, 2, (ctx, scale) => {
        // Barcode number
        ctx.font = `bold ${19*scale}px Inter, Arial`;
        ctx.fillStyle = "#f59e42";
        ctx.textAlign = "center";
        ctx.fillText(t3_barcode.value.trim(), 160*scale, 58*scale+18);
        // Display text
        ctx.font = `bold ${16*scale}px Inter, Arial`;
        ctx.fillStyle = "#334155";
        ctx.fillText(t3_text.value.trim(), 160*scale, 58*scale+38);
        // EXP/LOT
        ctx.font = `bold ${16*scale}px Inter, Arial`;
        ctx.fillStyle = "#222";
        ctx.textAlign = "left";
        ctx.fillText("EXP: " + (t3_exp.value.trim() || ""), 30*scale, 58*scale+58);
        ctx.fillText("LOT#: " + (t3_lot.value.trim() || ""), 170*scale, 58*scale+58);
      });
      copyImageDataUrlToClipboard(dataUrl);
    };

    // ====== TOOL 4 ======
    // Centered Custom Label Generator
    const t4_line1 = document.getElementById('t4-line1');
    const t4_mgVal = document.getElementById('t4-mgVal');
    const t4_mlVal = document.getElementById('t4-mlVal');
    const t4_lotVal = document.getElementById('t4-lotVal');
    const t4_manVal = document.getElementById('t4-manVal');
    const t4_expMonth = document.getElementById('t4-expMonth');
    const t4_expDay = document.getElementById('t4-expDay');
    const t4_expYear = document.getElementById('t4-expYear');
    const t4_barcodeVal = document.getElementById('t4-barcodeVal');
    const t4_svg = document.getElementById('t4-barcodePreview');
    const t4_copyBtn = document.getElementById('t4-copyBtn');

    function updateT4() {
      let val = t4_barcodeVal.value.trim();
      t4_svg.innerHTML = '';
      if (!val) return;
      try {
        JsBarcode(t4_svg, val, {format: "CODE128", height: 54, width: 2, displayValue: false, margin: 2});
      } catch {}
    }
    t4_barcodeVal.addEventListener('input', updateT4);

    t4_copyBtn.onclick = async function() {
      let line1 = t4_line1.value.trim();
      let mg = t4_mgVal.value.trim();
      let ml = t4_mlVal.value.trim();
      let lot = t4_lotVal.value.trim();
      let man = t4_manVal.value.trim();
      let expM = t4_expMonth.value.trim();
      let expD = t4_expDay.value.trim();
      let expY = t4_expYear.value.trim();
      let barcode = t4_barcodeVal.value.trim();

      await svgToPngDataUrl(t4_svg, 320, 60, 2, (ctx, scale) => {
        ctx.fillStyle = "#fff";
        ctx.fillRect(0, 0, 320*scale, 300*scale);
        ctx.font = `bold ${23*scale}px Inter, Arial`;
        ctx.fillStyle = "#222";
        ctx.textAlign = "center";
        let y = 35*scale;
        // Line 1
        ctx.fillText(line1, 160*scale, y);
        y += 36*scale;
        // mg/mL row
        ctx.font = `bold ${19*scale}px Inter, Arial`;
        ctx.fillText(`${mg} mg PER ${ml} mL`, 160*scale, y);
        y += 36*scale;
        // LOT/MAN row
        ctx.font = `bold ${15*scale}px Inter, Arial`;
        ctx.textAlign = "left";
        ctx.fillText(`LOT#: ${lot}`, 30*scale, y);
        ctx.textAlign = "right";
        ctx.fillText(`MAN: ${man}`, 310*scale, y);
        y += 30*scale;
        // EXP row
        ctx.textAlign = "center";
        ctx.fillText(`EXP: ${expM}/${expD}/${expY}`, 160*scale, y);
        y += 30*scale;
        // Barcode (rendered below, already present)
        // Draw barcode SVG onto canvas
        let svgData = new XMLSerializer().serializeToString(t4_svg);
        let img = new window.Image();
        img.onload = function() {
          ctx.drawImage(img, 35*scale, y, 250*scale, 54*scale);
          // Barcode number
          ctx.font = `bold ${18*scale}px Inter, Arial`;
          ctx.fillStyle = "#f59e42";
          ctx.textAlign = "center";
          ctx.fillText(barcode, 160*scale, y + 60*scale);
          // Done - copy
          let dataUrl = ctx.canvas.toDataURL("image/png");
          copyImageDataUrlToClipboard(dataUrl);
        };
        img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
      });
    };
  </script>
</body>
</html>
